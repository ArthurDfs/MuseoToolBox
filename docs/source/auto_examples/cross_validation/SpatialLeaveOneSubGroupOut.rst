.. note::
    :class: sphx-glr-download-link-note

    Click :ref:`here <sphx_glr_download_auto_examples_cross_validation_SpatialLeaveOneSubGroupOut.py>` to download the full example code
.. rst-class:: sphx-glr-example-title

.. _sphx_glr_auto_examples_cross_validation_SpatialLeaveOneSubGroupOut.py:


Spatial Leave-One-SubGroup-Out (SLOSGO)
======================================================

This example shows how to make a Spatial Leave-One-SubGroup-Out.


Import librairies
-------------------------------------------


.. code-block:: default

    import numpy as np
    from museotoolbox.cross_validation import SpatialLeaveOneSubGroupOut
    from museotoolbox import datasets,processing






Load HistoricalMap dataset
-------------------------------------------


.. code-block:: default


    _,centroid = datasets.load_historical_data(low_res=True,centroid=True)
    raster,vector = datasets.load_historical_data(low_res=True)

    field = 'Class'







Extract label ('Class' field) and groups ('uniquefid' field)
Compute distanceMatrix with centroid (one point per group)


.. code-block:: default


    X,y,groups = processing.extract_ROI(raster,vector,field,'uniquefid')
    distance_matrix,distance_label = processing.get_distance_matrix(raster,centroid,'uniquefid')







Create CV
-------------------------------------------
n_splits will be the number  of the least populated class


.. code-block:: default


    SLOSGO = SpatialLeaveOneSubGroupOut(distance_thresold=100,distance_matrix=distance_matrix,
                                       distance_label=distance_label,random_state=12)








.. note::
   Split is made to generate each fold


.. code-block:: default

    SLOSGO.get_n_splits(X,y,groups)
    for tr,vl in SLOSGO.split(X,y,groups):
        print(np.unique(groups[vl]))
        print(np.unique(groups[tr]))
    
    SLOSGO.save_to_vector(vector,'Class','uniquefid','/tmp/slosgo.gpkg')




.. rst-class:: sphx-glr-script-out

 Out:

 .. code-block:: none

    [ 6  9 11 12 16]
    [ 1  2  3  4  5  7  8 10 13 14 15]
    [ 1  5 13 14 17]
    [ 2  4  6  7  8  9 11 12 15]
    Warning : This function generates vector files according to your vector.
            The number of features may differ from the number of pixels used in classification.
            If you want to save every ROI pixels in the vector, please use processing.sample_extraction before.


Draw image


.. code-block:: default

    from __drawCVmethods import plotMethod
    plotMethod('SLOO-group')


.. image:: /auto_examples/cross_validation/images/sphx_glr_SpatialLeaveOneSubGroupOut_001.png
    :class: sphx-glr-single-img





.. rst-class:: sphx-glr-timing

   **Total running time of the script:** ( 0 minutes  0.162 seconds)


.. _sphx_glr_download_auto_examples_cross_validation_SpatialLeaveOneSubGroupOut.py:


.. only :: html

 .. container:: sphx-glr-footer
    :class: sphx-glr-footer-example



  .. container:: sphx-glr-download

     :download:`Download Python source code: SpatialLeaveOneSubGroupOut.py <SpatialLeaveOneSubGroupOut.py>`



  .. container:: sphx-glr-download

     :download:`Download Jupyter notebook: SpatialLeaveOneSubGroupOut.ipynb <SpatialLeaveOneSubGroupOut.ipynb>`


.. only:: html

 .. rst-class:: sphx-glr-signature

    `Gallery generated by Sphinx-Gallery <https://sphinx-gallery.readthedocs.io>`_
