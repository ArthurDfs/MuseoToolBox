.. note::
    :class: sphx-glr-download-link-note

    Click :ref:`here <sphx_glr_download_auto_examples_learn_tools_learnWithRFandCompareCV.py>` to download the full example code
.. rst-class:: sphx-glr-example-title

.. _sphx_glr_auto_examples_learn_tools_learnWithRFandCompareCV.py:


Learn with Random-Forest and compare Cross-Validation methods
===============================================================

This example shows how to make a classification with different cross-validation methods.


Import librairies
-------------------------------------------


.. code-block:: default


    from museotoolbox.learn_tools import learnAndPredict
    from museotoolbox import cross_validation
    from museotoolbox import datasets
    from sklearn.ensemble import RandomForestClassifier
    from sklearn.model_selection import StratifiedKFold







Load HistoricalMap dataset
-------------------------------------------


.. code-block:: default


    raster,vector = datasets.historicalMap(low_res=True)
    field = 'Class'
    group = 'uniquefid'







Initialize Random-Forest
---------------------------


.. code-block:: default


    classifier = RandomForestClassifier(random_state=12)







Create list of different CV
---------------------------


.. code-block:: default


    CVs = [cross_validation.RandomStratifiedKFold(n_splits=5),
           cross_validation.LeavePSubGroupOut(valid_size=0.5),
           cross_validation.LeaveOneSubGroupOut(),
           StratifiedKFold(n_splits=5) #from sklearn
           ]

    kappas=[]

    LAP = learnAndPredict()

    for cv in CVs : 
        
        LAP.learnFromRaster(raster,vector,inField=field,inGroup=group,cv=cv,
                            classifier=classifier,param_grid=dict(n_estimators=[100,200]))
        print('Kappa for '+str(type(cv).__name__))
        cvKappa = []
    
        for stats in LAP.getStatsFromCV(confusionMatrix=False,kappa=True):
            print(stats['kappa'])
            cvKappa.append(stats['kappa'])
    
        kappas.append(cvKappa)
    
        print(20*'=')




.. code-block:: pytb

    Traceback (most recent call last):
      File "/usr/local/lib/python3.6/dist-packages/sphinx_gallery/gen_rst.py", line 394, in _memory_usage
        out = func()
      File "/usr/local/lib/python3.6/dist-packages/sphinx_gallery/gen_rst.py", line 382, in __call__
        exec(self.code, self.globals)
      File "/mnt/DATA/lib/MuseoToolBox/examples/learn_tools/learnWithRFandCompareCV.py", line 51, in <module>
        classifier=classifier,param_grid=dict(n_estimators=[100,200]))
      File "/mnt/DATA/lib/MuseoToolBox/museotoolbox/learn_tools/__init__.py", line 230, in learnFromRaster
        **gridSearchCVParams)
      File "/mnt/DATA/lib/MuseoToolBox/museotoolbox/learn_tools/__init__.py", line 238, in __learn__
        X, y, groups) if cv is not None):
      File "/mnt/DATA/lib/MuseoToolBox/museotoolbox/cross_validation/_sampleSelection.py", line 134, in split
        X=X, y=y, groups=groups, verbose=self.verbose, **self.params)
      File "/mnt/DATA/lib/MuseoToolBox/museotoolbox/cross_validation/crossValidationClass.py", line 337, in __init__
        raise ValueError('Valid size is too small')
    ValueError: Valid size is too small




Plot example


.. code-block:: default



    from matplotlib import pyplot as plt
    plt.title('Kappa according to Cross-validation methods')
    plt.boxplot(kappas,labels=[str(type(i).__name__) for i in CVs], patch_artist=True)
    plt.grid()
    plt.ylabel('Kappa')
    plt.xticks(rotation=15)
    plt.show()


.. rst-class:: sphx-glr-timing

   **Total running time of the script:** ( 0 minutes  0.118 seconds)


.. _sphx_glr_download_auto_examples_learn_tools_learnWithRFandCompareCV.py:


.. only :: html

 .. container:: sphx-glr-footer
    :class: sphx-glr-footer-example



  .. container:: sphx-glr-download

     :download:`Download Python source code: learnWithRFandCompareCV.py <learnWithRFandCompareCV.py>`



  .. container:: sphx-glr-download

     :download:`Download Jupyter notebook: learnWithRFandCompareCV.ipynb <learnWithRFandCompareCV.ipynb>`


.. only:: html

 .. rst-class:: sphx-glr-signature

    `Gallery generated by Sphinx-Gallery <https://sphinx-gallery.readthedocs.io>`_
