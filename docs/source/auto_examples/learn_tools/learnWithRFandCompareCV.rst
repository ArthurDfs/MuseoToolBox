.. note::
    :class: sphx-glr-download-link-note

    Click :ref:`here <sphx_glr_download_auto_examples_learn_tools_learnWithRFandCompareCV.py>` to download the full example code
.. rst-class:: sphx-glr-example-title

.. _sphx_glr_auto_examples_learn_tools_learnWithRFandCompareCV.py:


Learn with Random-Forest and compare Cross-Validation methods
===============================================================

This example shows how to make a classification with different cross-validation methods.



Import librairies
-------------------------------------------



.. code-block:: python


    from museotoolbox.learn_tools import learnAndPredict
    from museotoolbox import cross_validation
    from museotoolbox import datasets
    from sklearn.ensemble import RandomForestClassifier
    from sklearn.model_selection import StratifiedKFold







Load HistoricalMap dataset
-------------------------------------------



.. code-block:: python


    raster,vector = datasets.historicalMap()
    field = 'Class'
    group = 'uniquefid'







Initialize Random-Forest
---------------------------



.. code-block:: python


    classifier = RandomForestClassifier(random_state=12)







Create list of different CV
---------------------------



.. code-block:: python


    CVs = [cross_validation.RandomStratifiedKFold(n_splits=5),
           cross_validation.LeavePSubGroupOut(valid_size=0.5),
           cross_validation.LeaveOneSubGroupOut(),
           StratifiedKFold(n_splits=5) #from sklearn
           ]

    kappas=[]

    LAP = learnAndPredict()

    for cv in CVs : 
        
        LAP.learnFromRaster(raster,vector,inField=field,inGroup=group,cv=cv,
                            classifier=classifier,param_grid=dict(n_estimators=[100,200]))
        print('Kappa for '+str(type(cv).__name__))
        cvKappa = []
    
        for stats in LAP.getStatsFromCV(confusionMatrix=False,kappa=True):
            print(stats['kappa'])
            cvKappa.append(stats['kappa'])
    
        kappas.append(cvKappa)
    
        print(20*'=')





.. rst-class:: sphx-glr-script-out

 Out:

 .. code-block:: none

    Received groups value, but randomCV don't use it
    Received groups value, but randomCV don't use it
    Received groups value, but randomCV don't use it
    Kappa for RandomStratifiedKFold
    0.9449216394803083
    0.9402962903419407
    0.956770458550679
    0.9527118613729597
    0.9498465389079399
    ====================
    Kappa for LeavePSubGroupOut
    0.7729732773963548
    0.7528741974239855
    ====================
    Kappa for LeaveOneSubGroupOut
    0.8455136259149088
    0.9639252475817985
    ====================
    Kappa for StratifiedKFold
    0.9328613433474189
    0.9005613348481454
    0.9037326056962451
    0.9552948967024273
    0.9554782694489665
    ====================


Plot example



.. code-block:: python



    from matplotlib import pyplot as plt
    plt.title('Kappa according to Cross-validation methods')
    plt.boxplot(kappas,labels=[str(type(i).__name__) for i in CVs], patch_artist=True)
    plt.grid()
    plt.ylabel('Kappa')
    plt.xticks(rotation=15)
    plt.show()



.. image:: /auto_examples/learn_tools/images/sphx_glr_learnWithRFandCompareCV_001.png
    :class: sphx-glr-single-img




**Total running time of the script:** ( 0 minutes  45.022 seconds)


.. _sphx_glr_download_auto_examples_learn_tools_learnWithRFandCompareCV.py:


.. only :: html

 .. container:: sphx-glr-footer
    :class: sphx-glr-footer-example



  .. container:: sphx-glr-download

     :download:`Download Python source code: learnWithRFandCompareCV.py <learnWithRFandCompareCV.py>`



  .. container:: sphx-glr-download

     :download:`Download Jupyter notebook: learnWithRFandCompareCV.ipynb <learnWithRFandCompareCV.ipynb>`


.. only:: html

 .. rst-class:: sphx-glr-signature

    `Gallery generated by Sphinx-Gallery <https://sphinx-gallery.readthedocs.io>`_
