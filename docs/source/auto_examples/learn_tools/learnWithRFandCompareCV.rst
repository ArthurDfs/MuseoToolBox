.. note::
    :class: sphx-glr-download-link-note

    Click :ref:`here <sphx_glr_download_auto_examples_learn_tools_learnWithRFandCompareCV.py>` to download the full example code
.. rst-class:: sphx-glr-example-title

.. _sphx_glr_auto_examples_learn_tools_learnWithRFandCompareCV.py:


Learn with Random-Forest and compare Cross-Validation methods
===============================================================

This example shows how to make a classification with different cross-validation methods.


Import librairies
-------------------------------------------


.. code-block:: default


    from museotoolbox.learn_tools import learnAndPredict
    from museotoolbox import cross_validation
    from museotoolbox import datasets
    from sklearn.ensemble import RandomForestClassifier
    from sklearn.model_selection import StratifiedKFold







Load HistoricalMap dataset
-------------------------------------------


.. code-block:: default


    raster,vector = datasets.historicalMap()
    field = 'Class'
    group = 'uniquefid'







Initialize Random-Forest
---------------------------


.. code-block:: default


    classifier = RandomForestClassifier(random_state=12)







Create list of different CV
---------------------------


.. code-block:: default


    CVs = [cross_validation.RandomStratifiedKFold(n_splits=5),
           cross_validation.LeavePSubGroupOut(valid_size=0.5),
           cross_validation.LeaveOneSubGroupOut(),
           StratifiedKFold(n_splits=5) #from sklearn
           ]

    kappas=[]

    LAP = learnAndPredict()

    for cv in CVs : 
        
        LAP.learnFromRaster(raster,vector,inField=field,inGroup=group,cv=cv,
                            classifier=classifier,param_grid=dict(n_estimators=[100,200]))
        print('Kappa for '+str(type(cv).__name__))
        cvKappa = []
    
        for stats in LAP.getStatsFromCV(confusionMatrix=False,kappa=True):
            print(stats['kappa'])
            cvKappa.append(stats['kappa'])
    
        kappas.append(cvKappa)
    
        print(20*'=')





.. rst-class:: sphx-glr-script-out

 Out:

 .. code-block:: none

    Received groups value, but randomCV don't use it
    Received groups value, but randomCV don't use it
    Received groups value, but randomCV don't use it
    Kappa for RandomStratifiedKFold
    0.9459508997985406
    0.950684223065908
    0.9448851656144066
    0.9434477048060472
    0.9499702757735622
    ====================
    Kappa for LeavePSubGroupOut
    0.6544460536982609
    0.6994215020651169
    ====================
    Kappa for LeaveOneSubGroupOut
    0.9443718915193251
    0.7742689896895922
    ====================
    Kappa for StratifiedKFold
    0.9328613433474189
    0.9005613348481454
    0.9037326056962451
    0.9552948967024273
    0.9554782694489665
    ====================


Plot example


.. code-block:: default



    from matplotlib import pyplot as plt
    plt.title('Kappa according to Cross-validation methods')
    plt.boxplot(kappas,labels=[str(type(i).__name__) for i in CVs], patch_artist=True)
    plt.grid()
    plt.ylabel('Kappa')
    plt.xticks(rotation=15)
    plt.show()



.. image:: /auto_examples/learn_tools/images/sphx_glr_learnWithRFandCompareCV_001.png
    :class: sphx-glr-single-img





.. rst-class:: sphx-glr-timing

   **Total running time of the script:** ( 0 minutes  44.455 seconds)


.. _sphx_glr_download_auto_examples_learn_tools_learnWithRFandCompareCV.py:


.. only :: html

 .. container:: sphx-glr-footer
    :class: sphx-glr-footer-example



  .. container:: sphx-glr-download

     :download:`Download Python source code: learnWithRFandCompareCV.py <learnWithRFandCompareCV.py>`



  .. container:: sphx-glr-download

     :download:`Download Jupyter notebook: learnWithRFandCompareCV.ipynb <learnWithRFandCompareCV.ipynb>`


.. only:: html

 .. rst-class:: sphx-glr-signature

    `Gallery generated by Sphinx-Gallery <https://sphinx-gallery.readthedocs.io>`_
